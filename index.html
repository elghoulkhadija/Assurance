<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Assurance Automobile - Maroc</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #7f8c8d;
            --success-color: #27ae60;
            --info-color: #2980b9;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --purple-color: #9b59b6;
            --dark-color: #2c3e50;
            --light-bg: #ecf0f1;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, .1);
        }

        body {
            background: linear-gradient(135deg, #ecf0f1, #dfe6e9);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, var(--dark-color), #34495e);
            box-shadow: 0 4px 20px rgba(0, 0, 0, .15);
        }

        .logo-container {
            background: #fff;
            padding: .3rem .8rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .2);
        }

        .logo-text {
            font-size: 1.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--purple-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .main-container {
            padding: 1rem 0;
        }

        /* NOUVEAU DESIGN DES CARTES KPI avec nouvelles couleurs */
        .kpi-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            border-left: 5px solid;
            border-bottom: 3px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .kpi-card.border-primary {
            border-left-color: var(--primary-color);
            background: linear-gradient(135deg, #ffffff, #ebf5fb);
        }

        .kpi-card.border-success {
            border-left-color: var(--success-color);
            background: linear-gradient(135deg, #ffffff, #eafaf1);
        }

        .kpi-card.border-info {
            border-left-color: var(--info-color);
            background: linear-gradient(135deg, #ffffff, #e8f4fc);
        }

        .kpi-card.border-warning {
            border-left-color: var(--warning-color);
            background: linear-gradient(135deg, #ffffff, #fef9e7);
        }

        .kpi-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 1.8rem;
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .kpi-card.border-primary .kpi-icon {
            background: linear-gradient(135deg, var(--primary-color), #5dade2);
        }

        .kpi-card.border-success .kpi-icon {
            background: linear-gradient(135deg, var(--success-color), #52be80);
        }

        .kpi-card.border-info .kpi-icon {
            background: linear-gradient(135deg, var(--info-color), #5dade2);
        }

        .kpi-card.border-warning .kpi-icon {
            background: linear-gradient(135deg, var(--warning-color), #f8c471);
        }

        .kpi-content {
            padding-left: 0.5rem;
        }

        .kpi-label {
            font-size: 0.85rem;
            color: var(--secondary-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        .kpi-trend {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .kpi-trend.up {
            color: var(--success-color);
        }

        .kpi-trend.down {
            color: var(--danger-color);
        }

        /* FILTRES AVEC ICÔNES */
        .filters-section {
            background: #fff;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
        }

        .filter-group {
            position: relative;
        }

        .filter-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: 1.1rem;
            z-index: 10;
        }

        .filter-select {
            padding-left: 45px !important;
            height: 50px;
            border-radius: 10px !important;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .filter-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }

        /* HEADER DE TABLEAU SIMPLE */
        .table-section {
            background: #fff;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }

        .table-modern {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }

        .table-modern thead th {
            color: #2e2222;
            font-weight: 600;
            font-size: 0.95rem;
            padding: 12px 15px;
            text-align: center;
            border: none;
            background-color: #c2939350;
            position: relative;
      
        }

        /* Séparateurs entre les colonnes de l'en-tête */
        .table-modern thead th:not(:last-child) {
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        .table-modern tbody tr {
            transition: all 0.2s ease;
            border-bottom: 1px solid #e0e0e0;
        }

        .table-modern tbody tr:last-child {
            border-bottom: none;
        }

        .table-modern tbody tr:hover {
            background-color: #f5f9ff;
        }

        .table-modern tbody td {
            padding: 12px 15px;
            color: #2c3e50;
            font-weight: 500;
            border: none;
            text-align: center;
            vertical-align: middle;
        }

        .table-modern tbody tr:nth-child(even) {
            background-color: #f9fafb;
        }

        .table-modern tbody tr:hover td {
            color: var(--primary-color);
        }

        .table-modern tbody td:first-child {
            font-weight: 700;
            color: var(--primary-color);
        }

        .table-modern .badge-custom {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }

        .badge-tiers {
            background-color: rgba(52, 152, 219, 0.15);
            color: var(--primary-color);
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .badge-tiers-plus {
            background-color: rgba(155, 89, 182, 0.15);
            color: var(--purple-color);
            border: 1px solid rgba(155, 89, 182, 0.3);
        }

        .badge-tous-risques {
            background-color: rgba(46, 204, 113, 0.15);
            color: var(--success-color);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .badge-moto {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--danger-color);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .badge-voiture {
            background-color: rgba(52, 152, 219, 0.15);
            color: var(--primary-color);
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .badge-camion {
            background-color: rgba(243, 156, 18, 0.15);
            color: var(--warning-color);
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .btn-import {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--purple-color), #8e44ad);
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-import:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(155, 89, 182, 0.4);
            background: linear-gradient(135deg, #8e44ad, var(--purple-color));
        }

        .btn-export {
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-export:hover {
            transform: translateY(-2px);
        }

        .btn-pdf {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            border: none;
            color: white;
        }

        .btn-word {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            border: none;
            color: white;
        }

        .btn-excel {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            border: none;
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, var(--secondary-color), #95a5a6);
            border: none;
            color: white;
        }

        /* Style pour la barre de recherche */
        .search-container {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            z-index: 10;
        }

        .search-input {
            padding-left: 45px;
            height: 45px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }

        /* Style pour le header de la table */
        .table-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0;
            padding: 15px 20px;
            margin-bottom: 0;
        }

        .table-header h4 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .table-header .badge-count {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .kpi-card {
                margin-bottom: 1rem;
            }
            
            .kpi-value {
                font-size: 1.8rem;
            }
            
            .table-modern {
                display: block;
                overflow-x: auto;
            }
            
            .btn-group {
                flex-wrap: wrap;
            }
            
            .btn-group .btn {
                margin-bottom: 5px;
            }
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-dark p-3">
        <div class="container-fluid d-flex align-items-center justify-content-between">
            <!-- Logo et titre -->
            <div class="d-flex align-items-center">
                <div class="logo-container d-flex align-items-center">
                    <img src="as.png" alt="Logo" style="height:40px; margin-right:10px;">
                    <i class="fas fa-car me-2"></i>
                    <span class="logo-text">ASSUR AUTO</span>
                </div>
                <h2 class="ms-4 mb-0 text-white" style="font-size:2rem;">Dashboard Assurance Automobile</h2>
            </div>

            <!-- Localisation -->
            <div class="text-white d-flex align-items-center">
                <i class="fas fa-map-marker-alt me-2"></i>Maroc
            </div>
        </div>
    </nav>

    <div class="container main-container">

        <div class="dashboard-content">

            <!-- KPI -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="kpi-card border-primary">
                        <div class="kpi-icon">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">Total Contrats</div>
                            <div class="kpi-value" id="totalContracts">0</div>
                            <div class="kpi-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>+12% ce mois</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="kpi-card border-success">
                        <div class="kpi-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">Prime Totale</div>
                            <div class="kpi-value" id="totalPrime">0 DH</div>
                            <div class="kpi-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>+8% ce mois</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="kpi-card border-info">
                        <div class="kpi-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">Prime Moyenne</div>
                            <div class="kpi-value" id="avgPrime">0 DH</div>
                            <div class="kpi-trend down">
                                <i class="fas fa-arrow-down"></i>
                                <span>-2% ce mois</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="kpi-card border-warning">
                        <div class="kpi-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-label">Valeur Véhicules</div>
                            <div class="kpi-value" id="totalVehicleValue">0 DH</div>
                            <div class="kpi-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>+15% ce mois</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FILTRES AVEC ICÔNES -->
            <div class="filters-section">
                <h5 class="mb-3"><i class="fas fa-filter me-2 text-primary"></i>Filtres Avancés</h5>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ville</label>
                        <div class="filter-group">
                            <i class="fas fa-city filter-icon"></i>
                            <select id="filterCity" class="form-select filter-select">
                                <option value="">Toutes les villes</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Type d'assurance</label>
                        <div class="filter-group">
                            <i class="fas fa-shield-alt filter-icon"></i>
                            <select id="filterInsuranceType" class="form-select filter-select">
                                <option value="">Tous les types</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Type de véhicule</label>
                        <div class="filter-group">
                            <i class="fas fa-car-side filter-icon"></i>
                            <select id="filterVehicleType" class="form-select filter-select">
                                <option value="">Tous les véhicules</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BOUTONS D'ACTION -->
            <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
                <div class="d-flex gap-2 flex-wrap mb-2">
                    <div class="position-relative">
                        <button class="btn btn-import" id="importBtn">
                            <i class="fas fa-file-upload me-2"></i>Importer Excel
                        </button>
                        <input type="file" id="excelFileInput" accept=".xlsx" class="d-none">
                    </div>
                    <button class="btn btn-pdf btn-export" onclick="exportToPDF()">
                        <i class="fas fa-file-pdf me-2"></i>Exporter PDF
                    </button>
                    <button class="btn btn-word btn-export" onclick="exportToWord()">
                        <i class="fas fa-file-word me-2"></i>Exporter Word
                    </button>
                    <button class="btn btn-excel btn-export" onclick="exportToExcel()">
                        <i class="fas fa-file-excel me-2"></i>Exporter Excel
                    </button>
                    <button class="btn btn-reset btn-export" onclick="resetToDefault()">
                        <i class="fas fa-redo me-2"></i>Réinitialiser
                    </button>
                </div>
                
                <div class="search-container" style="width: 300px;">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="tableSearch" class="form-control search-input" placeholder="Rechercher un contrat...">
                </div>
            </div>

            <!-- TABLE -->
            <div class="table-section">
                <!-- HEADER DE LA TABLE -->
                <div class="table-header d-flex justify-content-between align-items-center mb-3">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-list me-2"></i>
                        <h4 class="mb-0">Liste des Contrats d'Assurance</h4>
                    </div>
                    <div class="badge-count">
                        <span id="filterCount">0</span> contrats trouvés
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-modern" id="contractsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Client</th>
                                <th>Ville</th>
                                <th>Type Assurance</th>
                                <th>Type Véhicule</th>
                                <th>Prime Totale</th>
                                <th>Valeur Véhicule</th>
                                <th>Date Souscription</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Les données seront insérées ici par JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        // Données Excel fournies directement dans le code
        const defaultExcelData = [
            { ID_Client: 1, Nom: 'El Amrani', Prénom: 'Youssef', Ville: 'Ouarzazate', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 1560, Valeur_Vehicule: 93000, Date_Souscription: '2025-01-02 00:00:00' },
            { ID_Client: 2, Nom: 'Ait Lahcen', Prénom: 'Fatima', Ville: 'Ouarzazate', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 1620, Valeur_Vehicule: 96000, Date_Souscription: '2025-01-03 00:00:00' },
            { ID_Client: 3, Nom: 'Benali', Prénom: 'Ahmed', Ville: 'Marrakech', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 1680, Valeur_Vehicule: 99000, Date_Souscription: '2025-01-04 00:00:00' },
            { ID_Client: 4, Nom: 'El Idrissi', Prénom: 'Salma', Ville: 'Rabat', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 1740, Valeur_Vehicule: 102000, Date_Souscription: '2025-01-05 00:00:00' },
            { ID_Client: 5, Nom: 'Chraibi', Prénom: 'Mohamed', Ville: 'Casablanca', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 1800, Valeur_Vehicule: 105000, Date_Souscription: '2025-01-06 00:00:00' },
            { ID_Client: 6, Nom: 'Tahiri', Prénom: 'Khadija', Ville: 'Agadir', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 1860, Valeur_Vehicule: 108000, Date_Souscription: '2025-01-07 00:00:00' },
            { ID_Client: 7, Nom: 'Bennani', Prénom: 'Omar', Ville: 'Marrakech', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 1920, Valeur_Vehicule: 111000, Date_Souscription: '2025-01-08 00:00:00' },
            { ID_Client: 8, Nom: 'El Fassi', Prénom: 'Imane', Ville: 'Fes', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 1980, Valeur_Vehicule: 114000, Date_Souscription: '2025-01-09 00:00:00' },
            { ID_Client: 9, Nom: 'Alaoui', Prénom: 'Hassan', Ville: 'Rabat', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 2040, Valeur_Vehicule: 117000, Date_Souscription: '2025-01-10 00:00:00' },
            { ID_Client: 10, Nom: 'Zerouali', Prénom: 'Nadia', Ville: 'Agadir', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 2100, Valeur_Vehicule: 120000, Date_Souscription: '2025-01-11 00:00:00' },
            { ID_Client: 11, Nom: 'Skalli', Prénom: 'Abdelilah', Ville: 'Casablanca', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 2160, Valeur_Vehicule: 123000, Date_Souscription: '2025-01-12 00:00:00' },
            { ID_Client: 12, Nom: 'Raji', Prénom: 'Siham', Ville: 'Marrakech', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 2220, Valeur_Vehicule: 126000, Date_Souscription: '2025-01-13 00:00:00' },
            { ID_Client: 13, Nom: 'Ouahbi', Prénom: 'Anas', Ville: 'Ouarzazate', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 2280, Valeur_Vehicule: 129000, Date_Souscription: '2025-01-14 00:00:00' },
            { ID_Client: 14, Nom: 'Amine', Prénom: 'Soukaina', Ville: 'Agadir', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 2340, Valeur_Vehicule: 132000, Date_Souscription: '2025-01-15 00:00:00' },
            { ID_Client: 15, Nom: 'Mouline', Prénom: 'Rachid', Ville: 'Casablanca', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 2400, Valeur_Vehicule: 135000, Date_Souscription: '2025-01-16 00:00:00' },
            { ID_Client: 16, Nom: 'Lahlou', Prénom: 'Sara', Ville: 'Rabat', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 2460, Valeur_Vehicule: 138000, Date_Souscription: '2025-01-17 00:00:00' },
            { ID_Client: 17, Nom: 'Kabbaj', Prénom: 'Yassine', Ville: 'Marrakech', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 2520, Valeur_Vehicule: 141000, Date_Souscription: '2025-01-18 00:00:00' },
            { ID_Client: 18, Nom: 'Bouzidi', Prénom: 'Amina', Ville: 'Ouarzazate', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 2580, Valeur_Vehicule: 144000, Date_Souscription: '2025-01-19 00:00:00' },
            { ID_Client: 19, Nom: 'El Mansouri', Prénom: 'Karim', Ville: 'Agadir', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 2640, Valeur_Vehicule: 147000, Date_Souscription: '2025-01-20 00:00:00' },
            { ID_Client: 20, Nom: 'Haddad', Prénom: 'Latifa', Ville: 'Casablanca', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 2700, Valeur_Vehicule: 150000, Date_Souscription: '2025-01-21 00:00:00' },
            { ID_Client: 21, Nom: 'Berrada', Prénom: 'Ayoub', Ville: 'Rabat', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 2760, Valeur_Vehicule: 153000, Date_Souscription: '2025-01-22 00:00:00' },
            { ID_Client: 22, Nom: 'Sbaai', Prénom: 'Hanane', Ville: 'Marrakech', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 2820, Valeur_Vehicule: 156000, Date_Souscription: '2025-01-23 00:00:00' },
            { ID_Client: 23, Nom: 'Ghazali', Prénom: 'Mehdi', Ville: 'Agadir', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 2880, Valeur_Vehicule: 159000, Date_Souscription: '2025-01-24 00:00:00' },
            { ID_Client: 24, Nom: 'Benkirane', Prénom: 'Samir', Ville: 'Rabat', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 2940, Valeur_Vehicule: 162000, Date_Souscription: '2025-01-25 00:00:00' },
            { ID_Client: 25, Nom: 'El Khatib', Prénom: 'Meriem', Ville: 'Casablanca', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 3000, Valeur_Vehicule: 165000, Date_Souscription: '2025-01-26 00:00:00' },
            { ID_Client: 26, Nom: 'Azizi', Prénom: 'Hamza', Ville: 'Ouarzazate', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 3060, Valeur_Vehicule: 168000, Date_Souscription: '2025-01-27 00:00:00' },
            { ID_Client: 27, Nom: 'Raiss', Prénom: 'Nour', Ville: 'Agadir', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 3120, Valeur_Vehicule: 171000, Date_Souscription: '2025-01-28 00:00:00' },
            { ID_Client: 28, Nom: 'Fadili', Prénom: 'Abdelkader', Ville: 'Marrakech', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 3180, Valeur_Vehicule: 174000, Date_Souscription: '2025-01-01 00:00:00' },
            { ID_Client: 29, Nom: 'Kouhen', Prénom: 'Lina', Ville: 'Rabat', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 3240, Valeur_Vehicule: 177000, Date_Souscription: '2025-01-02 00:00:00' },
            { ID_Client: 30, Nom: 'Smires', Prénom: 'Younes', Ville: 'Casablanca', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 3300, Valeur_Vehicule: 180000, Date_Souscription: '2025-01-03 00:00:00' },
            { ID_Client: 31, Nom: 'Bounou', Prénom: 'Ikram', Ville: 'Agadir', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 3360, Valeur_Vehicule: 183000, Date_Souscription: '2025-01-04 00:00:00' },
            { ID_Client: 32, Nom: 'El Hachimi', Prénom: 'Said', Ville: 'Marrakech', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 3420, Valeur_Vehicule: 186000, Date_Souscription: '2025-01-05 00:00:00' },
            { ID_Client: 33, Nom: 'Zayani', Prénom: 'Rania', Ville: 'Rabat', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 3480, Valeur_Vehicule: 189000, Date_Souscription: '2025-01-06 00:00:00' },
            { ID_Client: 34, Nom: 'Belaid', Prénom: 'Yassir', Ville: 'Casablanca', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 3540, Valeur_Vehicule: 192000, Date_Souscription: '2025-01-07 00:00:00' },
            { ID_Client: 35, Nom: 'Ouhmid', Prénom: 'Malika', Ville: 'Ouarzazate', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 3600, Valeur_Vehicule: 195000, Date_Souscription: '2025-01-08 00:00:00' },
            { ID_Client: 36, Nom: 'Hami', Prénom: 'Reda', Ville: 'Agadir', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 3660, Valeur_Vehicule: 198000, Date_Souscription: '2025-01-09 00:00:00' },
            { ID_Client: 37, Nom: 'El Mouden', Prénom: 'Jamal', Ville: 'Marrakech', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 3720, Valeur_Vehicule: 201000, Date_Souscription: '2025-01-10 00:00:00' },
            { ID_Client: 38, Nom: 'Karrouchi', Prénom: 'Ilham', Ville: 'Rabat', Type_Vehicule: 'Camion', Type_Assurance: 'Tous Risques', Prime_Totale: 3780, Valeur_Vehicule: 204000, Date_Souscription: '2025-01-11 00:00:00' },
            { ID_Client: 39, Nom: 'Benchekroun', Prénom: 'Adil', Ville: 'Casablanca', Type_Vehicule: 'Voiture', Type_Assurance: 'Tiers', Prime_Totale: 3840, Valeur_Vehicule: 207000, Date_Souscription: '2025-01-12 00:00:00' },
            { ID_Client: 40, Nom: 'Ait Brahim', Prénom: 'Naima', Ville: 'Ouarzazate', Type_Vehicule: 'Moto', Type_Assurance: 'Tiers+', Prime_Totale: 3900, Valeur_Vehicule: 210000, Date_Souscription: '2025-01-13 00:00:00' }
        ];

        let allData = [], filteredData = [];
        let currentFile = null;

        // Charger les données par défaut au démarrage
        document.addEventListener('DOMContentLoaded', function() {
            loadDefaultData();
            setupEventListeners();
        });

        function loadDefaultData() {
            allData = defaultExcelData;
            filteredData = [...allData];
            
            populateFilters();
            updateDashboard();
            document.querySelector(".dashboard-content").style.display = "block";
        }

        function setupEventListeners() {
            // Recherche dans le tableau
            document.getElementById('tableSearch').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm === '') {
                    filteredData = [...allData];
                } else {
                    filteredData = allData.filter(item => 
                        item.Nom.toLowerCase().includes(searchTerm) ||
                        item.Prénom.toLowerCase().includes(searchTerm) ||
                        item.Ville.toLowerCase().includes(searchTerm) ||
                        item.Type_Assurance.toLowerCase().includes(searchTerm) ||
                        item.Type_Vehicule.toLowerCase().includes(searchTerm) ||
                        item.ID_Client.toString().includes(searchTerm)
                    );
                }
                updateDashboard();
            });
            
            // Bouton d'import
            document.getElementById('importBtn').addEventListener('click', function() {
                document.getElementById('excelFileInput').click();
            });
            
            // Input file pour l'import
            document.getElementById("excelFileInput").addEventListener("change", handleFileImport);
        }

        function handleFileImport(e) {
            const file = e.target.files[0]; 
            if (!file) return;
            
            currentFile = file;
            
            // Afficher une notification
            showNotification(`Fichier "${file.name}" importé avec succès!`, 'success');
            
            const reader = new FileReader();
            reader.onload = evt => {
                const workbook = XLSX.read(new Uint8Array(evt.target.result), { type: "array" });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(sheet, { defval: "" });

                allData = rows.map(r => {
                    let primeBase = parseFloat(r.Prime_Base) || 0;
                    let risque = parseFloat(r.Montant_Risque) || 0;
                    let primeTotale = parseFloat(r.Prime_Totale) || (primeBase + risque);
                    return {
                        ID_Client: r.ID_Client || "",
                        Nom: r.Nom || "",
                        Prénom: r.Prénom || "",
                        Ville: r.Ville || "",
                        Type_Assurance: r.Type_Assurance || "",
                        Type_Vehicule: r.Type_Vehicule || "",
                        Prime_Totale: primeTotale,
                        Valeur_Vehicule: parseFloat(r.Valeur_Vehicule) || 0,
                        Date_Souscription: r.Date_Souscription || ""
                    };
                });

                filteredData = [...allData];
                populateFilters();
                updateDashboard();
                document.querySelector(".dashboard-content").style.display = "block";
            };
            reader.readAsArrayBuffer(file);
        }

        function showNotification(message, type) {
            // Créer une notification simple
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px;';
            notification.innerHTML = `
                <strong>${type === 'success' ? 'Succès' : 'Erreur'}:</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Supprimer la notification après 3 secondes
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Fonction de réinitialisation
        function resetToDefault() {
            loadDefaultData();
            showNotification("Données réinitialisées avec succès!", 'success');
        }

        // FILTRES
        function populateFilters() {
            fill("filterCity", [...new Set(allData.map(x => x.Ville))]);
            fill("filterInsuranceType", [...new Set(allData.map(x => x.Type_Assurance))]);
            fill("filterVehicleType", [...new Set(allData.map(x => x.Type_Vehicule))]);
        }
        
        function fill(id, list) {
            const s = document.getElementById(id);
            s.innerHTML = s.options[0].outerHTML; // Garder la première option
            list.filter(Boolean).sort().forEach(v => s.innerHTML += `<option>${v}</option>`);
        }
        
        document.querySelectorAll("#filterCity,#filterInsuranceType,#filterVehicleType")
            .forEach(el => el.addEventListener("change", applyFilters));

        function applyFilters() {
            const city = document.getElementById('filterCity').value;
            const typeA = document.getElementById('filterInsuranceType').value;
            const typeV = document.getElementById('filterVehicleType').value;
            
            filteredData = allData.filter(r =>
                (!city || r.Ville === city) &&
                (!typeA || r.Type_Assurance === typeA) &&
                (!typeV || r.Type_Vehicule === typeV)
            );
            updateDashboard();
        }

        // DASHBOARD & TABLE
        function updateDashboard() {
            document.getElementById("totalContracts").textContent = filteredData.length;
            const totalPrime = filteredData.reduce((a, b) => a + (b.Prime_Totale || 0), 0);
            const avg = filteredData.length ? (totalPrime / filteredData.length) : 0;
            const totalVeh = filteredData.reduce((a, b) => a + (b.Valeur_Vehicule || 0), 0);

            document.getElementById("totalPrime").textContent = totalPrime.toLocaleString() + " DH";
            document.getElementById("avgPrime").textContent = avg.toFixed(2) + " DH";
            document.getElementById("totalVehicleValue").textContent = totalVeh.toLocaleString() + " DH";
            
            // Mettre à jour le compteur de contrats dans le header
            document.getElementById("filterCount").textContent = filteredData.length;

            const tbody = document.getElementById("tableBody");
            tbody.innerHTML = "";
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center py-5">
                            <i class="fas fa-search fa-2x text-muted mb-3"></i>
                            <p class="text-muted">Aucun contrat trouvé avec les critères sélectionnés</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredData.forEach(r => {
                // Déterminer le badge pour le type d'assurance
                let assuranceBadgeClass = '';
                if (r.Type_Assurance === 'Tiers') {
                    assuranceBadgeClass = 'badge-tiers';
                } else if (r.Type_Assurance === 'Tiers+') {
                    assuranceBadgeClass = 'badge-tiers-plus';
                } else if (r.Type_Assurance === 'Tous Risques') {
                    assuranceBadgeClass = 'badge-tous-risques';
                }
                
                // Déterminer le badge pour le type de véhicule
                let vehicleBadgeClass = '';
                if (r.Type_Vehicule === 'Moto') {
                    vehicleBadgeClass = 'badge-moto';
                } else if (r.Type_Vehicule === 'Voiture') {
                    vehicleBadgeClass = 'badge-voiture';
                } else if (r.Type_Vehicule === 'Camion') {
                    vehicleBadgeClass = 'badge-camion';
                }
                
                // Déterminer le statut basé sur la prime
                let status = "Standard";
                let statusClass = "badge-tiers";
                if (r.Prime_Totale >= 5000) {
                    status = "VIP";
                    statusClass = "badge-tous-risques";
                } else if (r.Prime_Totale >= 2000) {
                    status = "Premium";
                    statusClass = "badge-tiers-plus";
                }

                tbody.innerHTML += `
                    <tr>
                        <td><span class="fw-bold">${r.ID_Client}</span></td>
                        <td>${r.Nom} ${r.Prénom}</td>
                        <td><i class="fas fa-city me-1 text-muted"></i> ${r.Ville}</td>
                        <td><span class="badge-custom ${assuranceBadgeClass}">${r.Type_Assurance}</span></td>
                        <td><span class="badge-custom ${vehicleBadgeClass}">${r.Type_Vehicule}</span></td>
                        <td class="fw-bold" style="color: ${r.Prime_Totale > 2500 ? '#27ae60' : '#3498db'}">${r.Prime_Totale.toLocaleString()} DH</td>
                        <td>${r.Valeur_Vehicule.toLocaleString()} DH</td>
                        <td><span class="text-muted"><i class="far fa-calendar me-1"></i>${formatDate(r.Date_Souscription)}</span></td>
                        <td><span class="badge-custom ${statusClass}">${status}</span></td>
                    </tr>`;
            });
        }

        // Formater la date
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // EXPORTS
        function exportToExcel() {
            const ws = XLSX.utils.json_to_sheet(filteredData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Contrats");
            XLSX.writeFile(wb, "Contrats_Assurance.xlsx");
            showNotification("Export Excel effectué avec succès!", 'success');
        }
        
        function exportToWord() {
            let html = "<h2>Liste des Contrats d'Assurance</h2>";
            html += `<p>Exporté le ${new Date().toLocaleDateString('fr-FR')}</p>`;
            html += "<table border='1' style='border-collapse: collapse; width: 100%;'>";
            html += "<tr><th>ID</th><th>Nom</th><th>Ville</th><th>Assurance</th><th>Véhicule</th><th>Prime</th><th>Valeur Véhicule</th><th>Date</th></tr>";
            
            filteredData.forEach(r => {
                html += `<tr>
                    <td>${r.ID_Client}</td>
                    <td>${r.Nom} ${r.Prénom}</td>
                    <td>${r.Ville}</td>
                    <td>${r.Type_Assurance}</td>
                    <td>${r.Type_Vehicule}</td>
                    <td>${r.Prime_Totale} DH</td>
                    <td>${r.Valeur_Vehicule} DH</td>
                    <td>${formatDate(r.Date_Souscription)}</td>
                </tr>`;
            });
            
            html += "</table>";
            
            const blob = new Blob(['\ufeff', html], { type: 'application/msword' });
            saveAs(blob, "Contrats_Assurance.doc");
            showNotification("Export Word effectué avec succès!", 'success');
        }
        
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Titre
            doc.setFontSize(16);
            doc.setTextColor(52, 152, 219);
            doc.text("Liste des Contrats d'Assurance", 14, 15);
            
            // Date d'export
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text(`Exporté le ${new Date().toLocaleDateString('fr-FR')}`, 14, 22);
            
            // Tableau
            doc.autoTable({ 
                html: "#contractsTable", 
                startY: 30, 
                theme: "striped", 
                styles: { fontSize: 8, cellPadding: 3 },
                headStyles: { fillColor: [52, 152, 219], textColor: 255 },
                columnStyles: {
                    0: { cellWidth: 15 },
                    1: { cellWidth: 30 },
                    2: { cellWidth: 25 },
                    3: { cellWidth: 25 },
                    4: { cellWidth: 25 },
                    5: { cellWidth: 25 },
                    6: { cellWidth: 30 },
                    7: { cellWidth: 30 },
                    8: { cellWidth: 20 }
                }
            });
            
            doc.save("Contrats_Assurance.pdf");
            showNotification("Export PDF effectué avec succès!", 'success');
        }
    </script>
</body>

</html>